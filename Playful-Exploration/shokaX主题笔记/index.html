<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/miyano/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/miyano/assets/apple-touch-icon.png"><link rel="alternate" href="/miyano/rss.xml" title="自分の為に楽しめ世界" type="application/rss+xml"><link rel="alternate" href="/miyano/atom.xml" title="自分の為に楽しめ世界" type="application/atom+xml"><link rel="alternate" type="application/json" title="自分の為に楽しめ世界" href="https://ei4869.github.io/miyano/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="preconnect" href="https://cloudflare-imgbed-9os.pages.dev"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/app.css?v=0.4.17"><link rel="modulepreload" href="/miyano/js/chunk-352Z26K4.js"><link rel="modulepreload" href="/miyano/js/chunk-4ZFZY26B.js"><link rel="modulepreload" href="/miyano/js/chunk-BN4F4JMV.js"><link rel="modulepreload" href="/miyano/js/chunk-KABY3TZQ.js"><link rel="modulepreload" href="/miyano/js/chunk-RC7JEBHY.js"><link rel="modulepreload" href="/miyano/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/miyano/js/comments-F4ZK44WD.js"><link rel="modulepreload" href="/miyano/js/copy-tex-BIQFBMCI.js"><link rel="modulepreload" href="/miyano/js/index.esm-6Q7BVENK.js"><link rel="modulepreload" href="/miyano/js/post-WKBV5WBX.js"><link rel="modulepreload" href="/miyano/js/quicklink-2D2A767I.js"><link rel="modulepreload" href="/miyano/js/search-4CQPMKYW.js"><link rel="modulepreload" href="/miyano/js/siteInit.js"><link rel="modulepreload" href="/miyano/js/waline-NVSVNCZW.js"><link rel="stylesheet" href="/miyano/css/comments-LAB2J3GR.css" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/siteInit.css" media="none" onload="this.media='all'"><link rel="stylesheet" href="/miyano/css/waline-7JVHAYE3.css" media="none" onload="this.media='all'"><link rel="preload" href="https://cloudflare-imgbed-9os.pages.dev/file/eva_35.webp" as="image" fetchpriority="high"><link rel="preload" href="https://cloudflare-imgbed-9os.pages.dev/file/eva_27.webp" as="image" fetchpriority="high"><link rel="preload" href="https://cloudflare-imgbed-9os.pages.dev/file/eva_27.webp" as="image" fetchpriority="high"><link rel="preload" href="https://cloudflare-imgbed-9os.pages.dev/file/eva_19.webp" as="image" fetchpriority="high"><link rel="preload" href="https://cloudflare-imgbed-9os.pages.dev/file/eva_25.webp" as="image" fetchpriority="high"><link rel="preload" href="https://cloudflare-imgbed-9os.pages.dev/file/eva_18.webp" as="image" fetchpriority="high"><meta name="keywords" content="Blog,shokaX"><meta name="description" content="搭建shokaX主题的开发记录"><link rel="canonical" href="https://ei4869.github.io/miyano/Playful-Exploration/shokaX%E4%B8%BB%E9%A2%98%E7%AC%94%E8%AE%B0/"><script>window.sakuraConfig = {
  sakura: 30,
  xSpeed: 0.5,
  ySpeed: 0.5,
  rSpeed: 0.03,
  direction: "TopRight",
  zIndex: -1
};</script><script src="https://cdn.jsdelivr.net/gh/minz71/sakura-rain/sakura-rain.js" defer="defer"></script><title>shokaX主题-笔记</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">shokaX主题-笔记</h1><div class="meta"><span class="item" title="创建时间：2025-01-15 12:32:40"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-01-15T12:32:40+08:00">2025-01-15</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>40k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>37min</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/miyano/" rel="start">Rei の 手帳</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://cloudflare-imgbed-9os.pages.dev/file/eva_35.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://cloudflare-imgbed-9os.pages.dev/file/eva_27.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://cloudflare-imgbed-9os.pages.dev/file/eva_27.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://cloudflare-imgbed-9os.pages.dev/file/eva_19.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://cloudflare-imgbed-9os.pages.dev/file/eva_25.webp&quot;);"></li><li class="item" style="background-image: url(&quot;https://cloudflare-imgbed-9os.pages.dev/file/eva_18.webp&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement="" itemscope="" itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/miyano/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/miyano/categories/Playful-Exploration/" itemprop="item" rel="index" title="分类于整活探索"><span itemprop="name">整活探索<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://ei4869.github.io/miyano/Playful-Exploration/shokaX%E4%B8%BB%E9%A2%98%E7%AC%94%E8%AE%B0/"><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/miyano/assets/ai-icon.webp"><meta itemprop="name" content="Rei"><meta itemprop="description" content=", "></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="自分の為に楽しめ世界"></span><div class="body md" itemprop="articleBody"><details class="info"><summary>编辑记录</summary><div>
<div class="note info">
<p>2025-01-15 第一次编辑</p>
</div>
<ul>
<li>整理笔记</li>
</ul>
</div></details>
<hr>
<h1 id="安装过程"><a class="anchor" href="#安装过程">#</a> 安装过程</h1>
<p>主要参考官方的<a target="_blank" rel="noopener" href="https://docs.kaitaku.xyz/">文档</a>，安装通过如下命令：</p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>安装命令</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>hexo init       <span class="token comment">#初始化 hexo</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">cd</span> your_blog    <span class="token comment">#转到博客目录</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> shokax-cli <span class="token parameter variable">--location</span><span class="token operator">=</span>global     <span class="token comment">#全局安装</span></pre></td></tr><tr><td data-num="4"></td><td><pre>SXC <span class="token function">install</span> shokaX      <span class="token comment">#安装相关包和依赖</span></pre></td></tr></tbody></table></figure><p>接下来安装文档进行简单的初始配置。<br>
对于 <code>Hexo&gt;=7.0.0</code> ，需要停用停用默认代码高亮，</p>
<figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>syntax_highlighter: false</pre></td></tr><tr><td data-num="2"></td><td><pre>highlight:</pre></td></tr><tr><td data-num="3"></td><td><pre>  enable: false</pre></td></tr><tr><td data-num="4"></td><td><pre>  line_number: true</pre></td></tr><tr><td data-num="5"></td><td><pre>  auto_detect: false</pre></td></tr><tr><td data-num="6"></td><td><pre>  tab_replace: ''</pre></td></tr><tr><td data-num="7"></td><td><pre>  wrap: true</pre></td></tr><tr><td data-num="8"></td><td><pre>  hljs: false</pre></td></tr><tr><td data-num="9"></td><td><pre>prismjs:</pre></td></tr><tr><td data-num="10"></td><td><pre>  enable: false</pre></td></tr><tr><td data-num="11"></td><td><pre>  preprocess: true</pre></td></tr><tr><td data-num="12"></td><td><pre>  line_number: true</pre></td></tr><tr><td data-num="13"></td><td><pre>  tab_replace: ''</pre></td></tr></tbody></table></figure><div class="note info">
<p>注意在 <code>_config.yml</code>  中， <code>theme: shokaX</code> ，这里 X 要与 <code>_config.shokaX.yml</code>  中的一致即大写，否则 <code>hexo deploy</code>  部署后有问题主题渲染不出来。</p>
</div>
<h1 id="自动部署"><a class="anchor" href="#自动部署">#</a> 自动部署</h1>
<p>采用 <code>Github Pages</code>  进行自动部署，本个博客连接到之前的 Github 已有的存放博客代码的仓库中，作为新的分支<span class="pink"> shoka</span>，与之前的博客共同管理。</p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>新建分支共同管理</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> /path/to/原博客源码</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">git</span> checkout main</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">git</span> branch shoka</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">git</span> checkout shoka</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">git</span> commit --allow-empty <span class="token parameter variable">-m</span> <span class="token string">"Initialize empty shoka branch"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">git</span> push origin shoka <span class="token parameter variable">--force</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">git</span> checkout main</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token builtin class-name">cd</span> /path/to/新博客源码</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">git</span> init</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">git</span> remote <span class="token function">add</span> origin <span class="token operator">&lt;</span>远程仓库URL<span class="token operator">&gt;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">git</span> checkout shoka</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Initial commit for shoka blog"</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">git</span> push --set-upstream origin shoka</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">git</span> push origin shoka <span class="token parameter variable">--force</span></pre></td></tr></tbody></table></figure><p>自动部署，同时管理双博客的部署任务：</p>
<ul>
<li>如果为 push 触发，根据 push 的是哪个分支，设置哪个标志位为 <code>true</code> ，另一个则为 <code>false</code> 。</li>
<li>如果为 schedule 触发，则标志位都设置为 <code>true</code> ，顺序进行部署。</li>
<li>如果为手动触发，则可以选择部署哪一个或者同时部署。<br>
每个分支的部署按照同一套流程顺序执行，根据标志位判断是否执行。</li>
</ul>
<figure class="highlight yaml"><figcaption data-lang="YAML"><span>自动部署的工作流文件</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token key atrule">name</span><span class="token punctuation">:</span> 自动任务</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">push</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">branches</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token punctuation">-</span> master</pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">-</span> shoka</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">release</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">types</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">-</span> published</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">inputs</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token key atrule">branch</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"选择分支"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token string">"shoka"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token key atrule">options</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>          <span class="token punctuation">-</span> master</pre></td></tr><tr><td data-num="19"></td><td><pre>          <span class="token punctuation">-</span> shoka</pre></td></tr><tr><td data-num="20"></td><td><pre>          <span class="token punctuation">-</span> all</pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token key atrule">schedule</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">-</span> <span class="token key atrule">cron</span><span class="token punctuation">:</span> <span class="token string">"0 16 * * *"</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token key atrule">jobs</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token key atrule">deploy</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token key atrule">steps</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 确定分支和标志位</pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token key atrule">id</span><span class="token punctuation">:</span> setup_flags</pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="32"></td><td><pre>          if [[ "$" == "workflow_dispatch" ]]; then</pre></td></tr><tr><td data-num="33"></td><td><pre>            SELECTED_BRANCH="$"</pre></td></tr><tr><td data-num="34"></td><td><pre>          elif [[ "$" == "schedule" ]]; then</pre></td></tr><tr><td data-num="35"></td><td><pre>            SELECTED_BRANCH="all"</pre></td></tr><tr><td data-num="36"></td><td><pre>          else</pre></td></tr><tr><td data-num="37"></td><td><pre>            SELECTED_BRANCH="$"</pre></td></tr><tr><td data-num="38"></td><td><pre>          fi</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>          if <span class="token punctuation">[</span><span class="token punctuation">[</span> "$SELECTED_BRANCH" == "all" <span class="token punctuation">|</span><span class="token punctuation">|</span> "$SELECTED_BRANCH" == "master" <span class="token punctuation">]</span><span class="token punctuation">]</span>; then</pre></td></tr><tr><td data-num="41"></td><td><pre>            FLAG_MASTER=true</pre></td></tr><tr><td data-num="42"></td><td><pre>          else</pre></td></tr><tr><td data-num="43"></td><td><pre>            FLAG_MASTER=false</pre></td></tr><tr><td data-num="44"></td><td><pre>          fi</pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>          if <span class="token punctuation">[</span><span class="token punctuation">[</span> "$SELECTED_BRANCH" == "all" <span class="token punctuation">|</span><span class="token punctuation">|</span> "$SELECTED_BRANCH" == "shoka" <span class="token punctuation">]</span><span class="token punctuation">]</span>; then</pre></td></tr><tr><td data-num="47"></td><td><pre>            FLAG_SHOKA=true</pre></td></tr><tr><td data-num="48"></td><td><pre>          else</pre></td></tr><tr><td data-num="49"></td><td><pre>            FLAG_SHOKA=false</pre></td></tr><tr><td data-num="50"></td><td><pre>          fi</pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>          echo "SELECTED_BRANCH=$SELECTED_BRANCH" <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> $GITHUB_ENV</pre></td></tr><tr><td data-num="53"></td><td><pre>          echo "FLAG_MASTER=$FLAG_MASTER" <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> $GITHUB_ENV</pre></td></tr><tr><td data-num="54"></td><td><pre>          echo "FLAG_SHOKA=$FLAG_SHOKA" <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> $GITHUB_ENV</pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装 Node</pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1</pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="59"></td><td><pre>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">"20.x"</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 设置时区</pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "TZ='Asia/Shanghai'" <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> $GITHUB_ENV</pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 配置 Git 用户信息</pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="66"></td><td><pre>          git config --global user.name "$"</pre></td></tr><tr><td data-num="67"></td><td><pre>          git config --global user.email "$"</pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>      <span class="token comment"># 执行 Master 分支任务</span></pre></td></tr><tr><td data-num="70"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 克隆 Master 分支</pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2</pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="74"></td><td><pre>          <span class="token key atrule">ref</span><span class="token punctuation">:</span> master</pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 清除旧缓存（Master）</pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="79"></td><td><pre>          echo "Clearing old cache for Master branch..."</pre></td></tr><tr><td data-num="80"></td><td><pre>          rm -rf node_modules</pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 缓存 Hexo（Master）</pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v1</pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token key atrule">id</span><span class="token punctuation">:</span> cache_master</pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="87"></td><td><pre>          <span class="token key atrule">path</span><span class="token punctuation">:</span> node_modules</pre></td></tr><tr><td data-num="88"></td><td><pre>          <span class="token key atrule">key</span><span class="token punctuation">:</span> $&lt;<span class="token tag">!--swig</span>￼6<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">-</span>master<span class="token punctuation">-</span>$&lt;<span class="token tag">!--swig</span>￼7<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装依赖（Master）</pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span><span class="token punctuation">-</span>save</pre></td></tr><tr><td data-num="93"></td><td><pre></pre></td></tr><tr><td data-num="94"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 执行 Master 分支任务</pre></td></tr><tr><td data-num="95"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="96"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="97"></td><td><pre>          echo "Running tasks for Master branch..."</pre></td></tr><tr><td data-num="98"></td><td><pre>          node fix_kramed.js</pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装 Hexo（Master）</pre></td></tr><tr><td data-num="101"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="103"></td><td><pre>          export TZ='Asia/Shanghai'</pre></td></tr><tr><td data-num="104"></td><td><pre>          npm install hexo-cli -g</pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 生成静态文件（Master）</pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="109"></td><td><pre>          export TZ='Asia/Shanghai'</pre></td></tr><tr><td data-num="110"></td><td><pre>          hexo clean</pre></td></tr><tr><td data-num="111"></td><td><pre>          hexo generate</pre></td></tr><tr><td data-num="112"></td><td><pre>          gulp</pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 设置 SSH 密钥（Master）</pre></td></tr><tr><td data-num="115"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> webfactory/ssh<span class="token punctuation">-</span>agent@v0.5.3</pre></td></tr><tr><td data-num="117"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="118"></td><td><pre>          <span class="token key atrule">ssh-private-key</span><span class="token punctuation">:</span> $&lt;<span class="token tag">!--swig</span>￼8<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 部署（Master）</pre></td></tr><tr><td data-num="121"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_MASTER == 'true'</pre></td></tr><tr><td data-num="122"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> hexo deploy</pre></td></tr><tr><td data-num="123"></td><td><pre></pre></td></tr><tr><td data-num="124"></td><td><pre>      <span class="token comment"># 执行 Shoka 分支任务</span></pre></td></tr><tr><td data-num="125"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 克隆 Shoka 分支</pre></td></tr><tr><td data-num="126"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="127"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2</pre></td></tr><tr><td data-num="128"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="129"></td><td><pre>          <span class="token key atrule">ref</span><span class="token punctuation">:</span> shoka</pre></td></tr><tr><td data-num="130"></td><td><pre></pre></td></tr><tr><td data-num="131"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 清除旧缓存（Shoka）</pre></td></tr><tr><td data-num="132"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="133"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="134"></td><td><pre>          echo "Clearing old cache for Shoka branch..."</pre></td></tr><tr><td data-num="135"></td><td><pre>          rm -rf node_modules</pre></td></tr><tr><td data-num="136"></td><td><pre></pre></td></tr><tr><td data-num="137"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 缓存 Hexo（Shoka）</pre></td></tr><tr><td data-num="138"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="139"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v1</pre></td></tr><tr><td data-num="140"></td><td><pre>        <span class="token key atrule">id</span><span class="token punctuation">:</span> cache_shoka</pre></td></tr><tr><td data-num="141"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="142"></td><td><pre>          <span class="token key atrule">path</span><span class="token punctuation">:</span> node_modules</pre></td></tr><tr><td data-num="143"></td><td><pre>          <span class="token key atrule">key</span><span class="token punctuation">:</span> $&lt;<span class="token tag">!--swig</span>￼9<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">-</span>shoka<span class="token punctuation">-</span>$&lt;<span class="token tag">!--swig</span>￼10<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span></pre></td></tr><tr><td data-num="144"></td><td><pre></pre></td></tr><tr><td data-num="145"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装依赖（Shoka）</pre></td></tr><tr><td data-num="146"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="147"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span><span class="token punctuation">-</span>save</pre></td></tr><tr><td data-num="148"></td><td><pre></pre></td></tr><tr><td data-num="149"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 执行 Shoka 分支任务</pre></td></tr><tr><td data-num="150"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="151"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="152"></td><td><pre>          echo "Running tasks for Shoka branch..."</pre></td></tr><tr><td data-num="153"></td><td><pre>          node updateYaml.js</pre></td></tr><tr><td data-num="154"></td><td><pre>          echo "Contents of _images.yml:"</pre></td></tr><tr><td data-num="155"></td><td><pre>          cat ./themes/shokaX/_images.yml</pre></td></tr><tr><td data-num="156"></td><td><pre>          echo "Contents of _images_index.yml:"</pre></td></tr><tr><td data-num="157"></td><td><pre>          cat ./themes/shokaX/_images_index.yml</pre></td></tr><tr><td data-num="158"></td><td><pre>          ls -l source/_posts/*/cover.jpg || echo "No cover images found."</pre></td></tr><tr><td data-num="159"></td><td><pre></pre></td></tr><tr><td data-num="160"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装 Hexo（Shoka）</pre></td></tr><tr><td data-num="161"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="162"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="163"></td><td><pre>          export TZ='Asia/Shanghai'</pre></td></tr><tr><td data-num="164"></td><td><pre>          npm install hexo-cli -g</pre></td></tr><tr><td data-num="165"></td><td><pre></pre></td></tr><tr><td data-num="166"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 生成静态文件（Shoka）</pre></td></tr><tr><td data-num="167"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="168"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></pre></td></tr><tr><td data-num="169"></td><td><pre>          export TZ='Asia/Shanghai'</pre></td></tr><tr><td data-num="170"></td><td><pre>          hexo clean</pre></td></tr><tr><td data-num="171"></td><td><pre>          hexo generate</pre></td></tr><tr><td data-num="172"></td><td><pre>          hexo algolia</pre></td></tr><tr><td data-num="173"></td><td><pre></pre></td></tr><tr><td data-num="174"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 设置 SSH 密钥（Shoka）</pre></td></tr><tr><td data-num="175"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="176"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> webfactory/ssh<span class="token punctuation">-</span>agent@v0.5.3</pre></td></tr><tr><td data-num="177"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="178"></td><td><pre>          <span class="token key atrule">ssh-private-key</span><span class="token punctuation">:</span> $&lt;<span class="token tag">!--swig</span>￼11<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span></pre></td></tr><tr><td data-num="179"></td><td><pre></pre></td></tr><tr><td data-num="180"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 部署（Shoka）</pre></td></tr><tr><td data-num="181"></td><td><pre>        <span class="token key atrule">if</span><span class="token punctuation">:</span> env.FLAG_SHOKA == 'true'</pre></td></tr><tr><td data-num="182"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> hexo deploy</pre></td></tr></tbody></table></figure><h1 id="统计网站运行时间"><a class="anchor" href="#统计网站运行时间">#</a> 统计网站运行时间</h1>
<p>创建文件： <code>themes\shokaX\source\js\create-time.js</code> :</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>create-time.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">createtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">const</span> createTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2025/01/02 00:00:00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 替换为您的站点创建时间</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">const</span> diff <span class="token operator">=</span> now <span class="token operator">-</span> createTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">const</span> days <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>diff <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">const</span> hours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>diff <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">const</span> minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>diff <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">const</span> seconds <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>diff <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> </pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">此站已存活 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>days<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 天 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hours<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 小时 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>minutes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 分 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>seconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 秒</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">setInterval</span><span class="token punctuation">(</span>createtime<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>创建文件： <code>themes\shokaX\layout\_partials\create-time.pug</code> :</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>create-time.pug</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token function">div</span><span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">"width: 100%; text-align: center;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">span</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span> 此站已存活 <span class="token number">0</span> 天 <span class="token number">0</span> 小时 <span class="token number">0</span> 分 <span class="token number">0</span> 秒</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">"/miyano/js/create-time.js"</span> defer<span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><div class="note info">
<p>这里由于我的博客的 <code>Github Pages</code>  部署在仓库 <code>miyano</code>  中，所以默认的地址一般有多个 <code>/miyano</code> 。需要加上否则找不到文件路径。</p>
</div>
<p>最后在 <code>themes\shokaX\layout\_partials\footer.pug</code>  中第一行新增代码 <code>include create-time.pug</code>  即可引入站点存活时间。</p>
<h1 id="实现相册功能"><a class="anchor" href="#实现相册功能">#</a> 实现相册功能</h1>
<h2 id="相册主页面配置"><a class="anchor" href="#相册主页面配置">#</a> <span class="blue">相册</span>主页面配置</h2>
<ol>
<li>创建 <code>source\_data\gallery.yml</code>  用于存放相册数据，方便配置。格式为：</li>
</ol>
<figure class="highlight yaml"><figcaption data-lang="YAML"><span>相册数据格式gallery.yml</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token key atrule">gallery_groups</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> KON</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">descr</span><span class="token punctuation">:</span> KON一生推，毕业不是终点，今后也都是朋友。</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /miyano/gallery/kon/</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">img</span><span class="token punctuation">:</span> <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/kon_16.webp"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">photos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/kon_16.webp"</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Summer Pockets</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">descr</span><span class="token punctuation">:</span> 还记得那个夏天吗？那份炫目，别忘了口袋里的夏天。</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">url</span><span class="token punctuation">:</span> /miyano/gallery/sp/</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">img</span><span class="token punctuation">:</span> <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/sp_3.webp"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">photos</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/sp_4.webp"</span></pre></td></tr></tbody></table></figure><p>注意这里配置了 <code>id</code>  为 <code>gallery_groups</code> 。</p>
<ol start="2">
<li>创建 <code>themes\shokaX\layout\gallery.pug</code>  生成一个相册页面，展示多个相册组。</li>
</ol>
<figure class="highlight pug"><figcaption data-lang="pug"><span>gallery.pug</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">extends ./_partials/layout.pug</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">block content</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag">div<span class="token attr-id">#gallery-container</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">//- h1.page-title 相册</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag">div<span class="token attr-class">.gallery-group-main</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> group <span class="token keyword">in</span></span> page<span class="token punctuation">.</span>posts </span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value">group<span class="token punctuation">.</span>url target<span class="token operator">=</span><span class="token string">"_blank"</span></span><span class="token punctuation">)</span></span></span> </pre></td></tr><tr><td data-num="9"></td><td><pre>          <span class="token tag">figure<span class="token attr-class">.gallery-group</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token tag">img<span class="token attr-class">.gallery-group-img</span><span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">src</span><span class="token punctuation">=</span><span class="token attr-value">group<span class="token punctuation">.</span>img alt<span class="token operator">=</span>group<span class="token punctuation">.</span>name</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token tag">figcaption</span></pre></td></tr><tr><td data-num="12"></td><td><pre>              <span class="token tag">div<span class="token attr-class">.gallery-group-name</span></span><span class="token punctuation">=</span><span class="token code"> group<span class="token punctuation">.</span>name</span></pre></td></tr><tr><td data-num="13"></td><td><pre>              <span class="token tag">p</span><span class="token punctuation">=</span><span class="token code"> group<span class="token punctuation">.</span>descr</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">include _partials/pagination.pug</span></pre></td></tr></tbody></table></figure><p>使用 <code>each</code>  循环遍历 <code>page.posts</code>  中的每个相册组，并为每个相册组生成一个链接和相应的内容； <code>a(href=group.url target="_blank")</code> ：为每个相册组生成一个链接，链接地址为 <code>group.url</code> ，并在新标签页中打开；定义一个 <code>figcaption</code>  元素，用于包含相册组的标题和描述；包含 <code>_partials/pagination.pug</code>  文件，用于添加分页功能。</p>
<ol start="3">
<li>创建 <code>themes\shokaX\scripts\inject-gallery.js</code>  用于在生成静态网站时注入相册数据。将相册组数据注入到当前页面的本地变量 <code>locals.page.gallery_groups</code>  中，从而实现了在相册页面中动态加载相册数据的功能。</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>inject-gallery.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> yaml <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'js-yaml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'template_locals'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">locals</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>locals<span class="token punctuation">.</span>page<span class="token punctuation">.</span>layout <span class="token operator">===</span> <span class="token string">'gallery'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">const</span> galleryDataPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>hexo<span class="token punctuation">.</span>source_dir<span class="token punctuation">,</span> <span class="token string">'_data/gallery.yml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token keyword">const</span> data <span class="token operator">=</span> yaml<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>galleryDataPath<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>gallery_groups<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        locals<span class="token punctuation">.</span>page<span class="token punctuation">.</span>gallery_groups <span class="token operator">=</span> data<span class="token punctuation">.</span>gallery_groups<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        locals<span class="token punctuation">.</span>page<span class="token punctuation">.</span>gallery_groups <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error loading gallery.yml:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      locals<span class="token punctuation">.</span>page<span class="token punctuation">.</span>gallery_groups <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><div class="note info">
<p>需要在 <code>gallery</code>  的 <code>index.md</code>  配置好 <code>layout: gallery</code></p>
</div>
<ol start="3">
<li>创建 <code>themes\shokaX\source\css\_common\components\tags\gallery.styl</code>  用于设置相册页面的排列样式，效果是实现网格布局，每行最多显示三个相册，每个相册占据相等的宽度，鼠标悬停时有过渡效果显示相册描述。并对移动端单独适配，对于移动端一行只显示一个相册。该文件在 <code>themes\shokaX\source\css\_common\components\components.styl</code>  中引入： <code>@import 'tags/gallery';</code></li>
</ol>
<figure class="highlight stylus"><figcaption data-lang="stylus"><span>gallery.styl</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token selector"><span class="token comment">/* 限制 Gallery 样式作用域 */</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>.gallery-group-main</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property-declaration"><span class="token property">display</span> grid</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property-declaration"><span class="token property">grid-template-columns</span> <span class="token func"><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token unit">fr</span><span class="token punctuation">)</span> </span><span class="token comment">// 每行最多三个相册</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property-declaration"><span class="token property">gap</span> <span class="token number">20</span><span class="token unit">px</span> <span class="token comment">// 调整相册间距，确保布局更美观</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token property-declaration"><span class="token property">justify-items</span> center <span class="token comment">// 确保相册内容在单元格内居中</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token property-declaration"><span class="token property">padding</span> <span class="token number">20</span><span class="token unit">px</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">/* 移动端适配 */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token atrule-declaration"><span class="token atrule">@media</span> <span class="token punctuation">(</span>max-width<span class="token punctuation">:</span> <span class="token number">768</span><span class="token unit">px</span><span class="token punctuation">)</span> <span class="token comment">// 当屏幕宽度小于 768px 时</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token property-declaration"><span class="token property">grid-template-columns</span> <span class="token number">1</span><span class="token unit">fr</span> <span class="token comment">// 每行一个相册，按列排列</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property-declaration"><span class="token property">gap</span> <span class="token number">15</span><span class="token unit">px</span> <span class="token comment">// 调整相册间距，适应窄屏布局</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property-declaration"><span class="token property">padding</span> <span class="token number">10</span><span class="token unit">px</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token selector"><span class="token comment">/* 针对 Gallery 内的 Figure */</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>.gallery-group-main figure.gallery-group</pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token property-declaration"><span class="token property">position</span> relative</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token property-declaration"><span class="token property">width</span> <span class="token number">100</span><span class="token unit">%</span> <span class="token comment">// 使相册占满单元格宽度</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token property-declaration"><span class="token property">max-width</span> <span class="token number">300</span><span class="token unit">px</span> <span class="token comment">// 设置最大宽度，避免相册过大</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token property-declaration"><span class="token property">aspect-ratio</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">1</span> <span class="token comment">// 确保相册为正方形</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token property-declaration"><span class="token property">border-radius</span> <span class="token number">8</span><span class="token unit">px</span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token property-declaration"><span class="token property">background</span> <span class="token hexcode">#000000</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token property-declaration"><span class="token property">overflow</span> hidden</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token property-declaration"><span class="token property">transition</span> transform <span class="token number">0.3</span><span class="token unit">s</span><span class="token punctuation">,</span> box-shadow <span class="token number">0.3</span><span class="token unit">s</span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token property-declaration"><span class="token property">box-shadow</span> <span class="token number">0</span> <span class="token number">4</span><span class="token unit">px</span> <span class="token number">6</span><span class="token unit">px</span> <span class="token func"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token property-declaration"><span class="token property">cursor</span> pointer</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token selector">&amp;:hover</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token property-declaration"><span class="token property">transform</span> <span class="token func"><span class="token function">translateY</span><span class="token punctuation">(</span><span class="token number">-5</span><span class="token unit">px</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token property-declaration"><span class="token property">box-shadow</span> <span class="token number">0</span> <span class="token number">8</span><span class="token unit">px</span> <span class="token number">12</span><span class="token unit">px</span> <span class="token func"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token selector">img</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token property-declaration"><span class="token property">opacity</span> <span class="token number">0.4</span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token selector">figcaption</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token property-declaration"><span class="token property">opacity</span> <span class="token number">1</span></span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token selector"><span class="token comment">/* Gallery 内的 Image */</span></span></pre></td></tr><tr><td data-num="38"></td><td><pre>.gallery-group-main img.gallery-group-img</pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token property-declaration"><span class="token property">width</span> <span class="token number">100</span><span class="token unit">%</span></span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token property-declaration"><span class="token property">height</span> <span class="token number">100</span><span class="token unit">%</span></span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token property-declaration"><span class="token property">object-fit</span> cover</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token property-declaration"><span class="token property">transition</span> opacity <span class="token number">0.3</span><span class="token unit">s</span> ease</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token selector"><span class="token comment">/* Gallery 的 Caption 容器 */</span></span></pre></td></tr><tr><td data-num="45"></td><td><pre>.gallery-group-main figcaption</pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token property-declaration"><span class="token property">position</span> absolute</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token property-declaration"><span class="token property">bottom</span> <span class="token number">0</span></span></pre></td></tr><tr><td data-num="48"></td><td><pre>  <span class="token property-declaration"><span class="token property">left</span> <span class="token number">0</span></span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token property-declaration"><span class="token property">width</span> <span class="token number">100</span><span class="token unit">%</span></span></pre></td></tr><tr><td data-num="50"></td><td><pre>  <span class="token property-declaration"><span class="token property">padding</span> <span class="token number">15</span><span class="token unit">px</span></span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token property-declaration"><span class="token property">background</span> <span class="token func"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token property-declaration"><span class="token property">color</span> <span class="token hexcode">#fff</span></span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token property-declaration"><span class="token property">opacity</span> <span class="token number">0</span></span></pre></td></tr><tr><td data-num="54"></td><td><pre>  <span class="token property-declaration"><span class="token property">transition</span> opacity <span class="token number">0.3</span><span class="token unit">s</span> ease-<span class="token operator">in</span>-out</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>  <span class="token selector">.gallery-group-name</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token property-declaration"><span class="token property">margin</span> <span class="token number">0</span></span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token property-declaration"><span class="token property">font-size</span> <span class="token number">1.2</span><span class="token unit">em</span></span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token property-declaration"><span class="token property">line-height</span> <span class="token number">1.4</span></span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token property-declaration"><span class="token property">font-weight</span> bold</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token property-declaration"><span class="token property">text-shadow</span> <span class="token number">0</span> <span class="token number">2</span><span class="token unit">px</span> <span class="token number">4</span><span class="token unit">px</span> <span class="token func"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>  <span class="token selector">.gallery-group-descr</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token property-declaration"><span class="token property">margin</span> <span class="token number">10</span><span class="token unit">px</span> <span class="token number">0</span> <span class="token number">0</span></span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token property-declaration"><span class="token property">font-size</span> <span class="token number">0.9</span><span class="token unit">em</span></span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token property-declaration"><span class="token property">line-height</span> <span class="token number">1.4</span></span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token property-declaration"><span class="token property">text-shadow</span> <span class="token number">0</span> <span class="token number">2</span><span class="token unit">px</span> <span class="token number">4</span><span class="token unit">px</span> <span class="token func"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span></span></span></pre></td></tr></tbody></table></figure><ol start="4">
<li>调整 <code>themes\shokaX\source\css\_common\outline\sidebar\sidebar.styl</code>  对相册页面的侧边栏进行调整：取消侧边栏，位置由主页面占据。<br>
大约在原文件<span class="green"> 40-44</span> 新增:</li>
</ol>
<figure class="highlight stylus"><figcaption data-lang="stylus"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token selector"><span class="token comment">// 新增：gallery 页面隐藏 sidebar</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>body.gallery #sidebar <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property-declaration"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>在原文件<span class="green"> 74-89</span> 新增：</p>
<figure class="highlight stylus"><figcaption data-lang="stylus"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token selector"><span class="token comment">// 新增：gallery 页面 pjax 全宽</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>body.gallery .pjax <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property-declaration"><span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property-declaration"><span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property-declaration"><span class="token property">flex</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">}</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token selector"><span class="token comment">// 如果需要支持 flex 布局的全宽调整</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>.inner <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token selector"><span class="token comment">//gallery 页面全宽覆盖逻辑</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>  body.gallery &amp; &gt; .pjax <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property-declaration"><span class="token property">flex</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property-declaration"><span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><ol start="5">
<li>第<span class="yellow"> 4</span> 点需要指明相册页面的 body 的类 <code>class</code>  为 <code>gallery</code>  才能生效，且为了防止<em> PJAX</em> 导致的其他页面同步配置该效果，需要在 <code>themes\shokaX\source\js\_app\pjax\siteInit.ts</code>  中进行配置。</li>
</ol>
<figure class="highlight typescript"><figcaption data-lang="typescript"><span>siteinit.ts</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> domInit <span class="token keyword">from</span> <span class="token string">'./domInit'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> pjaxReload<span class="token punctuation">,</span> siteRefresh <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./refresh'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> cloudflareInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../components/cloudflare'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">BODY</span><span class="token punctuation">,</span> <span class="token constant">CONFIG</span><span class="token punctuation">,</span> pjax<span class="token punctuation">,</span> setPjax<span class="token punctuation">,</span> setSiteSearch<span class="token punctuation">,</span> siteSearch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../globals/globalVars'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> autoDarkmode<span class="token punctuation">,</span> themeColorListener <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../globals/themeColor'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> resizeHandle<span class="token punctuation">,</span> scrollHandle<span class="token punctuation">,</span> visibilityListener <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../globals/handles'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> pagePosition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../globals/tools'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> Pjax <span class="token keyword">from</span> <span class="token string">'theme-shokax-pjax'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> initVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../library/vue'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> $dom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../library/dom'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> createChild <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../library/proto'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">{</span> transition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../library/anime'</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="13"></td><td><pre><span class="token keyword">import</span> initializeGallery <span class="token keyword">from</span> <span class="token string">'../library/gallery'</span><span class="token punctuation">;</span> <span class="token comment">// 替换为实际路径</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="15"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">updateGalleryPageLayout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="16"></td><td><pre>  <span class="token keyword">const</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="17"></td><td><pre>  <span class="token keyword">const</span> footer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"footer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="18"></td><td><pre>  <span class="token keyword">const</span> main <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="19"></td><td><pre>  <span class="token keyword">const</span> headerAlternate <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#header .artboard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="20"></td><td><pre>  <span class="token keyword">const</span> headerTitle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#header .title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="21"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="22"></td><td><pre>  <span class="token keyword">const</span> HeaderMsgConfigPath <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取配置了 Header 参数的页面路径</span></pre></td></tr><tr class="marked"><td data-num="23"></td><td><pre>  <span class="token keyword">const</span> HeaderMsgConfig <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>pages<span class="token punctuation">[</span>HeaderMsgConfigPath<span class="token operator">+</span><span class="token string">'index.html'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 从页面元数据中获取当前页面配置</span></pre></td></tr><tr class="marked"><td data-num="24"></td><td><pre>  <span class="token comment">//console.log ("当前页面配置:", HeaderMsgConfig);</span></pre></td></tr><tr class="marked"><td data-num="25"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="26"></td><td><pre>  <span class="token keyword">const</span> DefaultHeaderMsgConfig <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>headerMsg</pre></td></tr><tr class="marked"><td data-num="27"></td><td><pre>  <span class="token comment">//console.log ("默认页面配置:", DefaultHeaderMsgConfig);</span></pre></td></tr><tr class="marked"><td data-num="28"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="29"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/gallery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="30"></td><td><pre>    body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"gallery"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="31"></td><td><pre>    </pre></td></tr><tr class="marked"><td data-num="32"></td><td><pre>    <span class="token comment">// 隐藏 footer</span></pre></td></tr><tr class="marked"><td data-num="33"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>footer<span class="token punctuation">)</span> footer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="34"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="35"></td><td><pre>    <span class="token comment">// 调整 main 的 margin-bottom</span></pre></td></tr><tr class="marked"><td data-num="36"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>main<span class="token punctuation">)</span> main<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginBottom <span class="token operator">=</span> <span class="token string">"0px"</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="37"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="38"></td><td><pre>    <span class="token comment">// 如果页面配置了自定义字段，则动态更新 header</span></pre></td></tr><tr class="marked"><td data-num="39"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>HeaderMsgConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="40"></td><td><pre>      <span class="token keyword">const</span> <span class="token punctuation">{</span> alternate<span class="token punctuation">,</span> headerTitle<span class="token operator">:</span> pageTitle <span class="token punctuation">}</span> <span class="token operator">=</span> HeaderMsgConfig<span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="41"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerAlternate <span class="token operator">&amp;&amp;</span> alternate<span class="token punctuation">)</span> headerAlternate<span class="token punctuation">.</span>textContent <span class="token operator">=</span> alternate<span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="42"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerTitle <span class="token operator">&amp;&amp;</span> pageTitle<span class="token punctuation">)</span> headerTitle<span class="token punctuation">.</span>textContent <span class="token operator">=</span> pageTitle<span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="43"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr class="marked"><td data-num="44"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="45"></td><td><pre>    <span class="token function">initializeGallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="46"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="47"></td><td><pre>    body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"gallery"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="48"></td><td><pre>    <span class="token comment">// 恢复 footer 的显示</span></pre></td></tr><tr class="marked"><td data-num="49"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>footer<span class="token punctuation">)</span> footer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="50"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="51"></td><td><pre>    <span class="token comment">// 恢复 main 的 margin-bottom</span></pre></td></tr><tr class="marked"><td data-num="52"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>main<span class="token punctuation">)</span> main<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginBottom <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="53"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="54"></td><td><pre>    <span class="token comment">// 恢复默认 header 内容</span></pre></td></tr><tr class="marked"><td data-num="55"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>DefaultHeaderMsgConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="56"></td><td><pre>      <span class="token keyword">const</span> <span class="token punctuation">{</span> alternate<span class="token punctuation">,</span> headerTitle<span class="token operator">:</span> pageTitle <span class="token punctuation">}</span> <span class="token operator">=</span> DefaultHeaderMsgConfig<span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="57"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerAlternate <span class="token operator">&amp;&amp;</span> alternate<span class="token punctuation">)</span> headerAlternate<span class="token punctuation">.</span>textContent <span class="token operator">=</span> alternate<span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="58"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerTitle <span class="token operator">&amp;&amp;</span> pageTitle<span class="token punctuation">)</span> headerTitle<span class="token punctuation">.</span>textContent <span class="token operator">=</span> pageTitle<span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="59"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr class="marked"><td data-num="60"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr class="marked"><td data-num="61"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="62"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="63"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">updateAnimePageLayout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="64"></td><td><pre>  <span class="token keyword">const</span> comment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"comments"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="65"></td><td><pre>  <span class="token keyword">const</span> main <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="66"></td><td><pre>  <span class="token keyword">const</span> footer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"footer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="67"></td><td><pre>  <span class="token keyword">const</span> ffooter <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'footer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="68"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/anime'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="69"></td><td><pre>    <span class="token comment">// 隐藏 footer</span></pre></td></tr><tr class="marked"><td data-num="70"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>comment<span class="token punctuation">)</span> comment<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="71"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>footer<span class="token punctuation">)</span> footer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="72"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ffooter<span class="token punctuation">)</span> ffooter<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="73"></td><td><pre>    <span class="token comment">// 调整 main 的 margin-bottom</span></pre></td></tr><tr class="marked"><td data-num="74"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>main<span class="token punctuation">)</span> main<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginBottom <span class="token operator">=</span> <span class="token string">"0px"</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="75"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="76"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/gallery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr class="marked"><td data-num="77"></td><td><pre>      <span class="token comment">// 恢复 footer 的显示</span></pre></td></tr><tr class="marked"><td data-num="78"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>comment<span class="token punctuation">)</span> comment<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="79"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>footer<span class="token punctuation">)</span> footer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="80"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>ffooter<span class="token punctuation">)</span> ffooter<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="81"></td><td><pre>      <span class="token comment">// 恢复 main 的 margin-bottom</span></pre></td></tr><tr class="marked"><td data-num="82"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>main<span class="token punctuation">)</span> main<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginBottom <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="83"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr class="marked"><td data-num="84"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr class="marked"><td data-num="85"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">siteInit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="88"></td><td><pre>  <span class="token function">initVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>  <span class="token function">domInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre>  <span class="token function">setPjax</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pjax</span><span class="token punctuation">(</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    selectors<span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="93"></td><td><pre>      <span class="token string">'head title'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="94"></td><td><pre>      <span class="token string">'.languages'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="95"></td><td><pre>      <span class="token string">'.twikoo'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="96"></td><td><pre>      <span class="token string">'.pjax'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="97"></td><td><pre>      <span class="token string">'.leancloud-recent-comment'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="98"></td><td><pre>      <span class="token string">'script[data-config]'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="99"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="100"></td><td><pre>    cacheBust<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="101"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre>  <span class="token constant">CONFIG</span><span class="token punctuation">.</span>quicklink<span class="token punctuation">.</span>ignores <span class="token operator">=</span> <span class="token constant">LOCAL</span><span class="token punctuation">.</span>ignores<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'quicklink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> listen <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="105"></td><td><pre>    <span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>quicklink<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre></pre></td></tr><tr><td data-num="108"></td><td><pre>  <span class="token function">autoDarkmode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre></pre></td></tr><tr><td data-num="110"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>__shokax_VL__<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="111"></td><td><pre>    <span class="token function">visibilityListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="113"></td><td><pre>  <span class="token function">themeColorListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre></pre></td></tr><tr><td data-num="115"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>__shokax_search__<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="116"></td><td><pre>    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'li.item.search &gt; i'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="117"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>search <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>      <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="120"></td><td><pre></pre></td></tr><tr><td data-num="121"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>siteSearch<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="122"></td><td><pre>        <span class="token function">setSiteSearch</span><span class="token punctuation">(</span><span class="token function">createChild</span><span class="token punctuation">(</span><span class="token constant">BODY</span><span class="token punctuation">,</span> <span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="123"></td><td><pre>          id<span class="token operator">:</span> <span class="token string">'search'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="124"></td><td><pre>          innerHTML<span class="token operator">:</span> <span class="token string">'&lt;div class="inner"&gt;&lt;div class="header"&gt;&lt;span class="icon"&gt;&lt;i class="ic i-search"&gt;&lt;/i&gt;&lt;/span&gt;&lt;div class="search-input-container"&gt;&lt;/div&gt;&lt;span class="close-btn"&gt;&lt;i class="ic i-times-circle"&gt;&lt;/i&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class="results"&gt;&lt;div class="inner"&gt;&lt;div id="search-stats"&gt;&lt;/div&gt;&lt;div id="search-hits"&gt;&lt;/div&gt;&lt;div id="search-pagination"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="125"></td><td><pre>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>      <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="127"></td><td><pre></pre></td></tr><tr><td data-num="128"></td><td><pre>      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../page/search'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> algoliaSearch <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="129"></td><td><pre>        <span class="token function">algoliaSearch</span><span class="token punctuation">(</span>pjax<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre></pre></td></tr><tr><td data-num="132"></td><td><pre>      $dom<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token string">'.search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="133"></td><td><pre>        element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="134"></td><td><pre>          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>          <span class="token function">transition</span><span class="token punctuation">(</span>siteSearch<span class="token punctuation">,</span> <span class="token string">'shrinkIn'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="136"></td><td><pre>            <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.search-input'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLInputElement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> once<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> capture<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="142"></td><td><pre></pre></td></tr><tr><td data-num="143"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>__shokax_fireworks__<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="144"></td><td><pre>    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'mouse-firework'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>firework<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="145"></td><td><pre>      firework<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>fireworks<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="147"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="148"></td><td><pre></pre></td></tr><tr class="marked"><td data-num="149"></td><td><pre>  <span class="token comment">// 初始化时更新 gallery 页面布局</span></pre></td></tr><tr class="marked"><td data-num="150"></td><td><pre>  <span class="token function">updateGalleryPageLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="151"></td><td><pre>  <span class="token function">updateAnimePageLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> scrollHandle<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> resizeHandle<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pjax:send'</span><span class="token punctuation">,</span> pjaxReload<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="155"></td><td><pre></pre></td></tr><tr><td data-num="156"></td><td><pre>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pjax:success'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="157"></td><td><pre>    <span class="token function">siteRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="158"></td><td><pre>    <span class="token function">updateGalleryPageLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// PJAX 切换完成后更新布局</span></pre></td></tr><tr class="marked"><td data-num="159"></td><td><pre>    <span class="token function">updateAnimePageLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="160"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre></pre></td></tr><tr><td data-num="162"></td><td><pre>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="163"></td><td><pre>    <span class="token function">pagePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="164"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="165"></td><td><pre></pre></td></tr><tr><td data-num="166"></td><td><pre>  <span class="token keyword">await</span> <span class="token function">siteRefresh</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="167"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="168"></td><td><pre></pre></td></tr><tr><td data-num="169"></td><td><pre><span class="token function">cloudflareInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="170"></td><td><pre></pre></td></tr><tr><td data-num="171"></td><td><pre>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> siteInit<span class="token punctuation">,</span> <span class="token punctuation">{</span> passive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="172"></td><td><pre></pre></td></tr><tr><td data-num="173"></td><td><pre><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'%c Theme.ShokaX v'</span> <span class="token operator">+</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>version <span class="token operator">+</span> <span class="token string">' %c https://github.com/theme-shoka-x/hexo-theme-shokaX '</span><span class="token punctuation">,</span> <span class="token string">'color: white; background: #e9546b; padding:5px 0;'</span><span class="token punctuation">,</span> <span class="token string">'padding:4px;border:1px solid #e9546b;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>先只关注这里的：</p>
<figure class="highlight typescript"><figcaption data-lang="typescript"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/gallery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'gallery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'gallery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>实现了动态切换类名。然后在 <code>siteInit</code>  函数中初始化时调用 <code>updateGalleryPageLayout();</code> ，在<em> PJAX</em> 切换完成后更新： <code>在 window.addEventListener('pjax:success', ...)</code>  中调用 <code>updateGalleryPageLayout();</code> ，确保切换页面时动态更新类名。<br>
并且同时使相册页面不显示 <code>footer</code> ，使 <code>&lt;main&gt;...&lt;/main&gt;</code>  容器可以适当向下增加空间。当处于 <code>gallery</code>  界面时隐藏 <code>footer</code>  并使 <code>main</code>  和底部边缘为 <code>0</code> ，否则恢复原样。</p>
<ol start="6">
<li>添加分页按钮<br>
创建文件： <code>themes\shokaX\scripts\generaters\gallery.js</code> ，用于处理分页逻辑，前面已经在 <code>themes\shokaX\layout\gallery.pug</code>  中引入了原来的分页布局： <code>include _partials/pagination.pug</code> ，并且已经有 <code>themes\shokaX\source\css\_common\scaffolding\pagination.styl</code>  文件。不用另外配置。</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>gallery.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> pagination <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hexo-pagination'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 主相册页面生成</span></pre></td></tr><tr><td data-num="5"></td><td><pre>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>generator<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'gallery'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">locals</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 确保读取 gallery_groups 下的数据</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">const</span> galleryGroups <span class="token operator">=</span> <span class="token punctuation">(</span>locals<span class="token punctuation">.</span>data<span class="token punctuation">.</span>gallery <span class="token operator">&amp;&amp;</span> locals<span class="token punctuation">.</span>data<span class="token punctuation">.</span>gallery<span class="token punctuation">.</span>gallery_groups<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>galleryGroups<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    hexo<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Gallery data is empty. Check your gallery.yml file.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">return</span> <span class="token function">pagination</span><span class="token punctuation">(</span><span class="token string">'/gallery'</span><span class="token punctuation">,</span> galleryGroups<span class="token punctuation">,</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token literal-property property">perPage</span><span class="token operator">:</span> hexo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>per_page <span class="token operator">||</span> <span class="token number">6</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token literal-property property">layout</span><span class="token operator">:</span> <span class="token string">'gallery'</span><span class="token punctuation">,</span>    <span class="token comment">// 使用 gallery.pug 模板</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token literal-property property">gallery</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 标记为相册页面</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>以上代码用于生成分页数据。在 <code>themes\shokaX\layout\gallery.pug</code>  通过 <code>page.posts</code>  读取分页数据并渲染分页数据。</p>
<h2 id="相册子页面配置"><a class="anchor" href="#相册子页面配置">#</a> <span class="blue">相册</span>子页面配置</h2>
<ol>
<li>创建文件： <code>themes\shokaX\layout\gallery-item.pug</code> ，用于生成一个相册组页面，展示相册组中的所有照片。</li>
</ol>
<figure class="highlight pug"><figcaption data-lang="pug"><span>gallery-item.pug</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">extends ./_partials/layout.pug</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">block content</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag">div<span class="token attr-class">.gallery-container</span><span class="token attr-class">.gallery-items</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> photo <span class="token keyword">in</span></span> page<span class="token punctuation">.</span>photos</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value">photo <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"gallery-item"</span> data<span class="token operator">-</span>src<span class="token operator">=</span>photo</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token tag">img<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">src</span><span class="token punctuation">=</span><span class="token attr-value">photo alt<span class="token operator">=</span>page<span class="token punctuation">.</span>group<span class="token punctuation">.</span>name title<span class="token operator">=</span>page<span class="token punctuation">.</span>group<span class="token punctuation">.</span>descr loading<span class="token operator">=</span><span class="token string">"lazy"</span></span><span class="token punctuation">)</span></span></span></pre></td></tr></tbody></table></figure><ol start="2">
<li><code>themes\shokaX\scripts\generaters\gallery.js</code>  中・增加代码传递 yml 的相册数据到 <code>gallery-item.pug</code>  被读取。</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>gallery.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 子相册页面生成</span></pre></td></tr><tr><td data-num="2"></td><td><pre>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>generator<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'galleryPages'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">locals</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">const</span> galleryGroups <span class="token operator">=</span> <span class="token punctuation">(</span>locals<span class="token punctuation">.</span>data<span class="token punctuation">.</span>gallery <span class="token operator">&amp;&amp;</span> locals<span class="token punctuation">.</span>data<span class="token punctuation">.</span>gallery<span class="token punctuation">.</span>gallery_groups<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  </pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">return</span> galleryGroups<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">group</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 确保 photos 是字符串数组</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">const</span> photos <span class="token operator">=</span> group<span class="token punctuation">.</span>photos <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 不再需要解析对象，直接返回数组内容</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 根据 URL 提取唯一标识符</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// const groupId = group.url.split('/').filter((part) =&gt; part).pop();</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/miyano'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 由于获取的 url 里已经含有 '/miyano' 导致重复，需要去掉。</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token literal-property property">layout</span><span class="token operator">:</span> <span class="token string">'gallery-item'</span><span class="token punctuation">,</span> <span class="token comment">// 使用 gallery-item.pug 模板</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        group<span class="token punctuation">,</span>      <span class="token comment">// 传递 group 数据</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        photos<span class="token punctuation">,</span>     <span class="token comment">// 直接传递字符串数组的 photos</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">//id: groupId // 传递唯一的 id</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token punctuation">}</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><ol start="3">
<li>实现相册集内图片的自动自适应布局以及灯箱功能，查看文档：<a target="_blank" rel="noopener" href="https://github.com/miromannino/Justified-Gallery">Justified-Gallery</a> 和<a target="_blank" rel="noopener" href="https://www.lightgalleryjs.com/"> lightgallery</a> 进行实现。<br>
依赖的文件有：</li>
</ol>
<ul>
<li><strong>CSS 文件</strong>:</li>
</ul>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/lightgallery/css/lightgallery.min.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></pre></td></tr></tbody></table></figure><ul>
<li><strong>JS 文件</strong>:</li>
</ul>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/lightgallery/lightgallery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/lightgallery/plugins/zoom/lg-zoom.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/lightgallery/plugins/thumbnail/lg-thumbnail.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></pre></td></tr></tbody></table></figure><p>需要创建文件 <code>themes\shokaX\source\js\_app\library\gallery.ts</code>  实现，动态导入了以上的 css 和 js 文件 (注意到其实 <code>shokaX</code>  已经实现的 <code>fancybox</code>  就是利用了 <code>justifiedGallery</code> ，并且已在 <code>_config.shokaX.yml</code>  中的 <code>vendors</code>  中引入了)。这里模仿了 <code>themes\shokaX\source\js\_app\page\fancybox.ts</code>  使用的方法。</p>
<figure class="highlight typescript"><figcaption data-lang="typescript"><span>gallery.ts</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 动态加载 CSS</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> loadCss <span class="token operator">=</span> <span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  link<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">'stylesheet'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  link<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 动态加载 JS</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">const</span> loadJs <span class="token operator">=</span> <span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    script<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to load script: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">const</span> destroyLightGallery <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">try</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// 获取所有 LightGallery 容器</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">const</span> lightGalleryContainers <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.lg-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// console.log('LightGallery containers found:', lightGalleryContainers);</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>lightGalleryContainers<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token comment">// console.log('No LightGallery instances found to destroy.');</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">// 遍历每个 LightGallery 容器</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    lightGalleryContainers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token comment">// console.log('Destroying LightGallery instance for container:', container);</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token comment">// 清理与 LightGallery 容器关联的事件</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token keyword">const</span> containerId <span class="token operator">=</span> container<span class="token punctuation">.</span>id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>      <span class="token keyword">const</span> backdrop <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">lg-backdrop-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>containerId<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>      <span class="token keyword">const</span> outer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">lg-outer-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>containerId<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>      <span class="token keyword">const</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">lg-content-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>containerId<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token comment">// 清理事件和相关子元素</span></pre></td></tr><tr><td data-num="41"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>backdrop<span class="token punctuation">)</span> backdrop<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>outer<span class="token punctuation">)</span> outer<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">)</span> content<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token comment">// 移除容器本身</span></pre></td></tr><tr><td data-num="46"></td><td><pre>      container<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>      <span class="token comment">// console.log('LightGallery instance and DOM elements destroyed for:', containerId);</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token comment">// 确保没有遗留的全局实例</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lgInstances<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="53"></td><td><pre>      <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lgInstances <span class="token operator">=</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lgInstances<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>inst<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">const</span> isDestroyed <span class="token operator">=</span> <span class="token operator">!</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>inst<span class="token punctuation">.</span>LGEl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isDestroyed<span class="token punctuation">)</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Removed destroyed instance:'</span><span class="token punctuation">,</span> inst<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">!</span>isDestroyed<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token comment">// console.log('All LightGallery instances and DOM cleaned up.');</span></pre></td></tr><tr><td data-num="61"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error destroying LightGallery instances:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment">// 初始化 Justified Gallery 和 LightGallery</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">const</span> initializeGallery <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="69"></td><td><pre>  <span class="token keyword">try</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token comment">// 动态加载 CSS</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token function">loadCss</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token function">loadCss</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/lightgallery/css/lightgallery-bundle.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token comment">// 动态加载 JS</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">loadJs</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">loadJs</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">loadJs</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/lightgallery/lightgallery.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">loadJs</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/lightgallery/plugins/zoom/lg-zoom.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">loadJs</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/lightgallery/plugins/thumbnail/lg-thumbnail.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">loadJs</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/lightgallery/plugins/autoplay/lg-autoplay.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">loadJs</span><span class="token punctuation">(</span><span class="token string">'https://cdn.jsdelivr.net/npm/lightgallery/plugins/rotate/lg-rotate.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>    <span class="token keyword">const</span> $ <span class="token operator">=</span> <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>jQuery<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>    <span class="token comment">//const pathSegments = window.location.pathname.split ('/').filter (segment =&gt; segment); // 提取路径段</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    <span class="token comment">//const galleryId = pathSegments [pathSegments.length - 1]; // 获取最后一个路径段</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    <span class="token keyword">const</span> galleryContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.gallery-items'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>galleryContainer<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="89"></td><td><pre>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'No gallery container found.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>      <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token comment">// 销毁现有 LightGallery 实例，防止重复初始化</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    <span class="token function">destroyLightGallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token comment">// 初始化 Justified Gallery</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token function">$</span><span class="token punctuation">(</span>galleryContainer<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="98"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">justifiedGallery</span><span class="token punctuation">(</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="99"></td><td><pre>        rowHeight<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        margins<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="101"></td><td><pre>        lastRow<span class="token operator">:</span> <span class="token string">'justify'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        captions<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="103"></td><td><pre>      <span class="token punctuation">}</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="104"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'jg.complete'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Justified Gallery layout complete.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token comment">// 初始化 LightGallery</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lightGallery</span><span class="token punctuation">(</span>galleryContainer<span class="token punctuation">,</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="109"></td><td><pre>          plugins<span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="110"></td><td><pre>            <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lgZoom<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lgThumbnail<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="112"></td><td><pre>            <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lgAutoplay<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="113"></td><td><pre>            <span class="token punctuation">(</span>window <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lgRotate<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="114"></td><td><pre>          <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="115"></td><td><pre>          speed<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="116"></td><td><pre>          thumbnail<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="117"></td><td><pre>          zoom<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LightGallery initialized.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="123"></td><td><pre>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error initializing gallery:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> initializeGallery<span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>首先，为了防止<em> PJAX</em> 的缓存问题，选择使用 ts 实现，并在 <code>siteinit.ts</code>  中导入该模块，实现 pjax 刷新，但遇到了 <code>lightgallery</code>  的对象没有清除，在切换相册时会叠加出现的问题，最后通过实现 <code>destroyLightGallery()</code>  方法，在每次初始化容器前都先清除对象防止对象叠加影响。<br>
关于 <code>justifiedGallery</code>  和 <code>lightGallery</code>  的实例化的参数详见文档。注意 <code>lightgallery</code>  增加插件 plugins 需要导入对应的脚本，这些脚本也可在文档查到。<br>
最后该模块 <code>initializeGallery</code>  在 <code>siteinit.ts</code>  中通过 <code>import initializeGallery from '../library/gallery';</code>  导入即可，放在 <code>updateGalleryPageLayout()</code>  内当处于 <code>gallery</code>  页面时。</p>
<h1 id="页面标题自定义"><a class="anchor" href="#页面标题自定义">#</a> 页面标题自定义</h1>
<p>就是显示在大封面的每个页面的两行字，即：</p>
<figure class="highlight typescript"><figcaption data-lang="typescript"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> headerAlternate <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#header .artboard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">const</span> headerTitle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#header .title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>实现可以在 <code>index.md</code>  中自定义配置。通过 <code>siteinit.ts</code>  中的 <code>import { BODY, CONFIG, pjax, setPjax, setSiteSearch, siteSearch } from '../globals/globalVars';</code>  中的 <code>CONFIG</code>  追踪到 <code>themes\shokaX\scripts\generaters\script.js</code> ，在<span class="green"> 31-64</span> 行中加入代码:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>script.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment">// 读取 gallery.yml 的数据</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">const</span> galleryData <span class="token operator">=</span> hexo<span class="token punctuation">.</span>locals<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gallery <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  locals<span class="token punctuation">.</span>pages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// galleryData.gallery_groups.forEach((group) =&gt; {</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">//   // 去掉 Group URL 中的 "miyano/" 前缀</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//   const groupUrl = group.url.replace(/^\/?miyano\//, "").replace(/\/$/, "");</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//   // 去掉 Page Path 中的 "index.html" 后缀</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">//   const pagePath = page.path.replace(/index\.html$/, "").replace(/\/$/, "");</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">//   console.log("Page Path:", pagePath);</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">//   console.log("Group URL:", groupUrl);</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// });</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">const</span> galleryItem <span class="token operator">=</span> galleryData<span class="token punctuation">.</span>gallery_groups<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">(</span><span class="token parameter">group</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> page<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">index\.html$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">===</span> group<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/?miyano\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>galleryItem<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      page<span class="token punctuation">.</span>alternate <span class="token operator">=</span> galleryItem<span class="token punctuation">.</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      page<span class="token punctuation">.</span>headerTitle <span class="token operator">=</span> galleryItem<span class="token punctuation">.</span>descr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  </pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token comment">// 动态生成页面元数据</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">const</span> pages <span class="token operator">=</span> locals<span class="token punctuation">.</span>pages<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> page</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">const</span> metadata <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span>alternate<span class="token punctuation">)</span> metadata<span class="token punctuation">.</span>alternate <span class="token operator">=</span> page<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span>headerTitle<span class="token punctuation">)</span> metadata<span class="token punctuation">.</span>headerTitle <span class="token operator">=</span> page<span class="token punctuation">.</span>headerTitle<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      acc<span class="token punctuation">[</span>page<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> metadata<span class="token punctuation">;</span> <span class="token comment">// 仅记录有自定义参数的页面</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">return</span> acc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token comment">//console.log ("页面数据：",pages);</span></pre></td></tr></tbody></table></figure><p>其中，对于子相册页面，通过读取 <code>source\_data\gallery.yml</code>  中的 <code>name</code>  和 <code>descr</code>  参数作为该页面的 <code>alternate</code>  和 <code>headerTitle</code>  的数据。其中需要获取到和当前子页面路径匹配的 yml 中对应的 url 的数据。需要对两个路径分别进行处理才能得到一致的结构获取到对应的数据。<br>
后面一步则是获取 <code>index.md</code>  中有配置 <code>alternate</code>  和 <code>headerTitle</code>  参数的页面，如果有配置，则返回该页面 <code>pages</code> （带有页面路径和配置的参数值的数据。）<br>
在<span class="green"> 66-69</span> 添加代码获取默认的 <code>alternate</code>  和 <code>title</code>  参数用于默认的页面标题。<br>
在<span class="green"> 110</span> 添加参数 pages.</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>script.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token literal-property property">headerMsg</span><span class="token operator">:</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token literal-property property">alternate</span><span class="token operator">:</span> theme<span class="token punctuation">.</span>alternate<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token literal-property property">title</span><span class="token operator">:</span> config<span class="token punctuation">.</span>title<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    pages<span class="token punctuation">,</span></pre></td></tr></tbody></table></figure><p>接着，在 <code>siteinit.ts</code>  中，加入下面代码:</p>
<figure class="highlight typescript"><figcaption data-lang="typescript"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">updateGalleryPageLayout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">const</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">const</span> footer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"footer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> main <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">const</span> headerAlternate <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#header .artboard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">const</span> headerTitle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#header .title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">const</span> HeaderMsgConfigPath <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取配置了 Header 参数的页面路径</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">const</span> HeaderMsgConfig <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>pages<span class="token punctuation">[</span>HeaderMsgConfigPath<span class="token operator">+</span><span class="token string">'index.html'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 从页面元数据中获取当前页面配置</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">//console.log ("当前页面配置:", HeaderMsgConfig);</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">const</span> DefaultHeaderMsgConfig <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>headerMsg</pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">//console.log ("默认页面配置:", DefaultHeaderMsgConfig);</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/gallery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"gallery"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">// 隐藏 footer</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>footer<span class="token punctuation">)</span> footer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 调整 main 的 margin-bottom</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>main<span class="token punctuation">)</span> main<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginBottom <span class="token operator">=</span> <span class="token string">"0px"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 如果页面配置了自定义字段，则动态更新 header</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>HeaderMsgConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token keyword">const</span> <span class="token punctuation">{</span> alternate<span class="token punctuation">,</span> headerTitle<span class="token operator">:</span> pageTitle <span class="token punctuation">}</span> <span class="token operator">=</span> HeaderMsgConfig<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerAlternate <span class="token operator">&amp;&amp;</span> alternate<span class="token punctuation">)</span> headerAlternate<span class="token punctuation">.</span>textContent <span class="token operator">=</span> alternate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerTitle <span class="token operator">&amp;&amp;</span> pageTitle<span class="token punctuation">)</span> headerTitle<span class="token punctuation">.</span>textContent <span class="token operator">=</span> pageTitle<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token function">initializeGallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"gallery"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">// 恢复 footer 的显示</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>footer<span class="token punctuation">)</span> footer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment">// 恢复 main 的 margin-bottom</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>main<span class="token punctuation">)</span> main<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginBottom <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token comment">// 恢复默认 header 内容</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>DefaultHeaderMsgConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token keyword">const</span> <span class="token punctuation">{</span> alternate<span class="token punctuation">,</span> headerTitle<span class="token operator">:</span> pageTitle <span class="token punctuation">}</span> <span class="token operator">=</span> DefaultHeaderMsgConfig<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerAlternate <span class="token operator">&amp;&amp;</span> alternate<span class="token punctuation">)</span> headerAlternate<span class="token punctuation">.</span>textContent <span class="token operator">=</span> alternate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headerTitle <span class="token operator">&amp;&amp;</span> pageTitle<span class="token punctuation">)</span> headerTitle<span class="token punctuation">.</span>textContent <span class="token operator">=</span> pageTitle<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>实现了页面的 <code>Header</code>  字段自定义，退出 <code>gallery</code>  页面时则恢复默认。</p>
<h1 id="每天随机主题图片"><a class="anchor" href="#每天随机主题图片">#</a> 每天随机主题图片</h1>
<ol>
<li><code>themes\shokaX\_images_index.yml</code>  为首页图片源文件， <code>themes\shokaX\_images.yml</code>  为首页的后备图片源和文章的图片源。创建一个 <code>themes\shokaX\images.json</code>  用于管理各个主题的图片集，格式为：</li>
</ol>
<figure class="highlight json"><figcaption data-lang="JSON"><span>images.json</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"kon"</span><span class="token operator">:</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token property">"home"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/kon_14.webp"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token property">"articles"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/kon_28.webp"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"eva"</span><span class="token operator">:</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token property">"home"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/eva_35.webp"</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token property">"articles"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/eva_23.webp"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">}</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token property">"sp"</span><span class="token operator">:</span> <span class="token punctuation">{</span> </pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token property">"home"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/sp_3.webp"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token property">"articles"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/ghibli_31.webp"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token property">"articles"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="27"></td><td><pre>          <span class="token string">"https://cloudflare-imgbed-9os.pages.dev/file/ghibli_9.webp"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="29"></td><td><pre>     <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>分别存储了用于首页和文章的图片。</p>
<ol start="2">
<li>创建文件： <code>updateYaml.js</code> ，用于根据日期选择主题或者根据 <code>_config.shokaX.yml</code>  中配置的 <code>Mytheme</code>  选择主题。通过读取<em> json</em> 文件，将图片集写入两个<em> yml</em> 文件，运行 <code>node updateYaml.js</code>  实现更新。这一步在自动部署中定时实现。</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>updateYaml.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// JSON 文件路径</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">const</span> jsonFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"themes/shokaX/images.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// YAML 文件路径</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> indexYmlPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"themes/shokaX/_images_index.yml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> articleYmlPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"themes/shokaX/_images.yml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 主题图片文件夹路径</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">const</span> coverImgDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"source/_data/coverimg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 博客文章文件夹路径</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">const</span> postsDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"source/_posts"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 获取当前主题逻辑</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">getTheme</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">const</span> configPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"_config.shokaX.yml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">const</span> config <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>configPath<span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">const</span> match <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MyTheme:\s*(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">return</span> match <span class="token operator">?</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// 随机从数组中选取 n 个元素</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">getRandomElements</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">const</span> shuffled <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0.5</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token keyword">return</span> shuffled<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">// 获取文件夹数量</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">getSubfolderCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">const</span> itemPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>itemPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">// 更新 YAML 文件和生成封面图片</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">updateYmlFiles</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token keyword">const</span> jsonData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>jsonFilePath<span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token keyword">let</span> selectedTheme <span class="token operator">=</span> theme<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>theme <span class="token operator">===</span> <span class="token string">"default"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="46"></td><td><pre>      <span class="token keyword">const</span> themes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"kon"</span><span class="token punctuation">,</span> <span class="token string">"sp"</span><span class="token punctuation">,</span> <span class="token string">"eva"</span><span class="token punctuation">,</span> <span class="token string">"ghibli"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token keyword">const</span> currentDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>      <span class="token keyword">const</span> beijingTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>currentDate<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// UTC 时间转为北京时间</span></pre></td></tr><tr><td data-num="49"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"beijingTime:"</span><span class="token punctuation">,</span>beijingTime<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>      beijingTime<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span>beijingTime<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在当前日期上加上 d_day, 为了与另一个网站主题同步</span></pre></td></tr><tr><td data-num="51"></td><td><pre>      <span class="token keyword">const</span> formattedDate <span class="token operator">=</span> beijingTime<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取修改后的日期的 YYYY-MM-DD 格式</span></pre></td></tr><tr><td data-num="52"></td><td><pre>      <span class="token keyword">const</span> hash <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>formattedDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> char</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> char<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算日期字符串的哈希值</span></pre></td></tr><tr><td data-num="53"></td><td><pre>      <span class="token keyword">const</span> themeIndex <span class="token operator">=</span> hash <span class="token operator">%</span> themes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// 对主题数组长度取模</span></pre></td></tr><tr><td data-num="54"></td><td><pre>      selectedTheme <span class="token operator">=</span> themes<span class="token punctuation">[</span>themeIndex<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"selectedTheme"</span><span class="token punctuation">,</span>selectedTheme<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token keyword">const</span> homeImages <span class="token operator">=</span> jsonData<span class="token punctuation">[</span>selectedTheme<span class="token punctuation">]</span><span class="token operator">?.</span>home <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  <span class="token keyword">const</span> articleImages <span class="token operator">=</span> jsonData<span class="token punctuation">[</span>selectedTheme<span class="token punctuation">]</span><span class="token operator">?.</span>articles <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token comment">// 写入 YAML 文件</span></pre></td></tr><tr><td data-num="61"></td><td><pre>  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>indexYmlPath<span class="token punctuation">,</span> homeImages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>articleYmlPath<span class="token punctuation">,</span> articleImages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">YAML files updated for theme: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selectedTheme<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre>  <span class="token comment">// 获取主题对应的图片文件夹</span></pre></td></tr><tr><td data-num="67"></td><td><pre>  <span class="token keyword">const</span> themeCoverDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>coverImgDir<span class="token punctuation">,</span> selectedTheme<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>themeCoverDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Theme folder not found: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>themeCoverDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token comment">// 获取主题图片列表</span></pre></td></tr><tr><td data-num="74"></td><td><pre>  <span class="token keyword">const</span> themeImages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>themeCoverDir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|jpeg|png|webp)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>themeImages<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="76"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">No images found in theme folder: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>themeCoverDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="79"></td><td><pre></pre></td></tr><tr><td data-num="80"></td><td><pre>  <span class="token comment">// 获取博客文章文件夹数量</span></pre></td></tr><tr><td data-num="81"></td><td><pre>  <span class="token keyword">const</span> postFolders <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>postsDir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="82"></td><td><pre>    <span class="token keyword">const</span> itemPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>postsDir<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>    <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>itemPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre>  <span class="token comment">// 随机选取图片并生成 cover.jpg</span></pre></td></tr><tr><td data-num="87"></td><td><pre>  <span class="token keyword">const</span> selectedImages <span class="token operator">=</span> <span class="token function">getRandomElements</span><span class="token punctuation">(</span>themeImages<span class="token punctuation">,</span> postFolders<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>  postFolders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">folder<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="89"></td><td><pre>    <span class="token keyword">const</span> postFolderPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>postsDir<span class="token punctuation">,</span> folder<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token keyword">const</span> sourceImagePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>themeCoverDir<span class="token punctuation">,</span> selectedImages<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    <span class="token keyword">const</span> outputImagePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>postFolderPath<span class="token punctuation">,</span> <span class="token string">"cover.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token comment">// 复制图片为 cover.jpg</span></pre></td></tr><tr><td data-num="94"></td><td><pre>    fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>sourceImagePath<span class="token punctuation">,</span> outputImagePath<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cover.jpg created for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>folder<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token function">updateYmlFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>注意：对于分类卡片的图片，需要先创建分类的文章文件夹，在每个分类文件夹下存入对应的文章，再加上一张 <code>cover.jpg</code> ，必须命名为该格式，才能渲染出卡片。要实现分类卡片的主题切换，于是新建 <code>source\_data\coverimg</code>  文件夹，里面再设置各个主题的子文件夹，每个主题下存入对应图片的 <code>jpg</code>  图片， <code>updateYaml.js</code>  则根据当天主题将该主题下的图片抽取重命名为 <code>cover</code>  后覆盖掉原来分类文件夹里的图片，作为当前主题的分类卡片图片。(注意每个主题下存入的图片数量需大于分类的类别数量。)<br>
 附：首页的分类卡片，还需要在 <code>_config.yml</code>  中进行配置，如：</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># Category &amp; Tag</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">default_category</span><span class="token punctuation">:</span> uncategorized</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">category_map</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">文献翻译</span><span class="token punctuation">:</span> Literature<span class="token punctuation">-</span>Translation</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">整活探索</span><span class="token punctuation">:</span> Playful<span class="token punctuation">-</span>Exploration</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">科研笔记</span><span class="token punctuation">:</span> Scientific<span class="token punctuation">-</span>Notes</pre></td></tr></tbody></table></figure><div class="note info">
<p>为了使部署后的网页的分类卡片能立即刷新，可以加入时间戳清除缓存，修改 <code>themes\shokaX\layout\_mixin\card.pug</code> ，第<span class="green"> 2</span> 行修改为:</p>
<figure class="highlight pug"><figcaption data-lang="pug"><span>card.pug</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> timestamp <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">-</span><span class="token code"> cover <span class="token operator">=</span> <span class="token function">url_for</span><span class="token punctuation">(</span>theme<span class="token punctuation">.</span>statics <span class="token operator">+</span> item<span class="token punctuation">.</span>slug <span class="token operator">+</span> <span class="token string">'/cover.jpg'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'?v='</span> <span class="token operator">+</span> timestamp</span></pre></td></tr></tbody></table></figure></div>
<div class="note info">
<p>注意：js 获取的时间 <code>const currentDate = new Date();</code>  为<em> UTC</em> 时间，需要转为<em> UTC+8</em> 的北京时间，不然更新主题会出错。</p>
</div>
<h1 id="增改一些参数"><a class="anchor" href="#增改一些参数">#</a> 增改一些参数</h1>
<ol>
<li><code>_config.shokaX.yml</code>  中 <code>widgets</code>  中增加参数：</li>
</ol>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token key atrule">widgets</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment"># if true, will show random posts</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">random_posts</span><span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">post_number</span><span class="token punctuation">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment"># if true, will show recent comments</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">recent_comments</span><span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">comment_number</span><span class="token punctuation">:</span> <span class="token number">5</span></pre></td></tr></tbody></table></figure><p>用于配置随机文章和最新评论的显示数量。<br>
于是在 <code>themes\shokaX\scripts\generaters\script.js</code>  第<span class="green"> 70</span> 增加代码：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>script.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token literal-property property">recent_comments_count</span><span class="token operator">:</span> theme<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>recent_comments<span class="token punctuation">.</span>comment_number<span class="token punctuation">,</span></pre></td></tr></tbody></table></figure><p>修改 <code>themes\shokaX\source\js\_app\components\comments.ts</code> ，首先，为了点击最新评论后能正确跳转到该评论所在文章，需要修改第<span class="green"> 32</span> 行为：</p>
<figure class="highlight typescript"><figcaption data-lang="typescript"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> shokax_siteURL<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(https?:\/\/)?[^/]*(\/miyano)?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>防止重复的 <code>'/miyano'</code> 。接着，修改<span class="green"> 34-37</span> 为：</p>
<figure class="highlight typescript"><figcaption data-lang="typescript"><span>comment.ts</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> <span class="token punctuation">{</span> comments <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">RecentComments</span><span class="token punctuation">(</span><span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    serverURL<span class="token operator">:</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>waline<span class="token punctuation">.</span>serverURL<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    count<span class="token operator">:</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span>recent_comments_count <span class="token operator">||</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">}</span><span class="token punctuation">)</span></pre></td></tr></tbody></table></figure><p>应用设置的参数作为评论数量。<br>
修改 <code>themes\shokaX\layout\_mixin\widgets.pug</code> ，<span class="green">19-22</span> 修改为:</p>
<figure class="highlight pug"><figcaption data-lang="pug"><span>widgets.pug</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> postNumber <span class="token operator">=</span> theme<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>random_posts<span class="token punctuation">.</span>post_number <span class="token operator">||</span> <span class="token number">5</span> <span class="token comment">// 默认值为 5</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> posts <span class="token operator">=</span> site<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>postNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 使用配置的 post_number</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> item <span class="token keyword">in</span></span> posts</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token tag">field<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">item</span><span class="token punctuation">)</span></span></span></pre></td></tr></tbody></table></figure><ol start="2">
<li>修改站点文章阅读时间的格式<br>
修改 <code>themes\shokaX\scripts\helpers\symbols_count_time.js</code>  的<span class="green"> 28-37</span> 为:</li>
</ol>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>symbols_count_time.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">getFormatTime</span><span class="token punctuation">(</span><span class="token parameter">minutes<span class="token punctuation">,</span> suffix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">const</span> fHours <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">let</span> fMinutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>minutes <span class="token operator">-</span> fHours <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>fMinutes <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    fMinutes <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">}</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// return fHours &lt; 1 ? fMinutes + " " + suffix : fHours + ":" + ("00" + fMinutes).slice(-2);</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 修改时间格式化方式为？h?min</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">return</span> fHours <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fMinutes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">min</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fHours<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">h</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fMinutes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">min</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><p>显示时间的格式改为 <code>?h?min</code> 。</p>
<ol start="3">
<li>
<p>增加或修改图标<br>
按照<a target="_blank" rel="noopener" href="https://docs.kaitaku.xyz/">文档</a>操作，组建自己的图标项目，生成 css 代码，将需要的图标代码加入 <code>themes\shokaX\source\css\_iconfont.styl</code>  文件中。</p>
</li>
<li>
<p>增加或修改字段<br>
修改文件 <code>themes\shokaX\languages\zh-CN.yml</code> ，例如：</p>
</li>
</ol>
<figure class="highlight yaml"><figcaption data-lang="YAML"><span>zh-CN.yml</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token key atrule">favicon</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment"># show: （●´3｀●）やれやれだぜ</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">show</span><span class="token punctuation">:</span> （●´3｀●）萌え萌えキュン</pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">hide</span><span class="token punctuation">:</span> (´Д｀)大変だ！</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token key atrule">menu</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">gallery</span><span class="token punctuation">:</span> 相册</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">repository</span><span class="token punctuation">:</span> 宝箱</pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">anime</span><span class="token punctuation">:</span> 追番</pre></td></tr></tbody></table></figure><h1 id="移除头图模糊"><a class="anchor" href="#移除头图模糊">#</a> 移除头图模糊</h1>
<p>参考<a target="_blank" rel="noopener" href="https://blog.minz.li/shokaX/ShokaX%E6%8F%92%E4%BB%B6-%E7%A7%BB%E9%99%A4%E9%A0%82%E9%83%A8%E9%9C%A7%E9%9D%A2%E6%95%88%E6%9E%9C/">链接</a>，新建文件： <code>themes\shokaX\scripts\removeTopBlur.js</code> ，内容为：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>removeTopBlur.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'theme_inject'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">injects</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    injects<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'themes/shokaX/source/views/removeTopBlur.styl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>新建文件： <code>themes\shokaX\source\views\removeTopBlur.styl</code> ，内容为：</p>
<figure class="highlight stylus"><figcaption data-lang="stylus"><span>removeTopBlur.styl</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token selector">#nav <span class="token punctuation">{</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property-declaration"><span class="token property">backdrop-filter</span><span class="token punctuation">:</span> <span class="token func"><span class="token function">saturate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">)</span> <span class="token func"><span class="token function">blur</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token unit">px</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token selector">&amp;.show <span class="token punctuation">{</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token property-declaration"><span class="token property">backdrop-filter</span><span class="token punctuation">:</span> <span class="token func"><span class="token function">saturate</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token unit">%</span><span class="token punctuation">)</span> <span class="token func"><span class="token function">blur</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">}</span>   </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">}</span></pre></td></tr></tbody></table></figure><h1 id="增加头图樱花特效"><a class="anchor" href="#增加头图樱花特效">#</a> 增加头图樱花特效</h1>
<p>参考<a target="_blank" rel="noopener" href="https://blog.minz.li/shokaX/ShokaX%E6%8F%92%E4%BB%B6-%E6%AB%BB%E8%8A%B1/">链接</a>，新建文件： <code>themes\shokaX\scripts\sakura.js</code> ，内容为：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"><span>sakura.js</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>hexo<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'theme_inject'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">injects</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    injects<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'sakura'</span><span class="token punctuation">,</span> <span class="token string">'themes/shokaX/source/views/sakura.pug'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></tbody></table></figure><p>新建文件： <code>themes\shokaX\source\views\sakura.pug</code> ，内容为：</p>
<figure class="highlight pug"><figcaption data-lang="pug"><span>sakura.pug</span></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token tag">script</span><span class="token punctuation">.</span><span class="token multiline-script"></span></pre></td></tr><tr><td data-num="2"></td><td><pre>      window<span class="token punctuation">.</span>sakuraConfig <span class="token operator">=</span> <span class="token punctuation">{</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token literal-property property">sakura</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token literal-property property">xSpeed</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token literal-property property">ySpeed</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token literal-property property">rSpeed</span><span class="token operator">:</span> <span class="token number">0.03</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token literal-property property">direction</span><span class="token operator">:</span> <span class="token string">"TopRight"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token literal-property property">zIndex</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">}</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token tag">script<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">src</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">"https://cdn.jsdelivr.net/gh/minz71/sakura-rain/sakura-rain.js"</span> defer</span><span class="token punctuation">)</span></span></span></pre></td></tr></tbody></table></figure><h1 id="设置音乐列表"><a class="anchor" href="#设置音乐列表">#</a> 设置音乐列表</h1>
<p>在 <code>_config.shokaX.yml</code>  中配置：</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token key atrule">audio</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> KON</pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token key atrule">list</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>     <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//music.163.com/<span class="token comment">#/playlist?id=8881745341</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> Summer Pockets</pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token key atrule">list</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>     <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//y.qq.com/n/ryqq/playlist/7784860213</pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> EVA</pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token key atrule">list</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>     <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//y.qq.com/n/ryqq/playlist/1754837879</pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token punctuation">-</span> <span class="token key atrule">title</span><span class="token punctuation">:</span> Ghibli</pre></td></tr><tr><td data-num="12"></td><td><pre>   <span class="token key atrule">list</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>     <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//y.qq.com/n/ryqq/playlist/2854515338</pre></td></tr></tbody></table></figure><h1 id="设置追番页面"><a class="anchor" href="#设置追番页面">#</a> 设置追番页面</h1>
<p>路径为： <code>source\anime\index.html</code> ，需要是 <code>html</code>  的格式。需要安装：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre>$ <span class="token function">npm</span> <span class="token function">install</span> hexo-bilibili-bangumi <span class="token parameter variable">--save</span></pre></td></tr></tbody></table></figure><p>在 <code>_config.yml</code>  中进行配置：</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token comment"># 追番插件</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># https://github.com/HCLonely/hexo-bilibili-bangumi</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">bangumi</span><span class="token punctuation">:</span> <span class="token comment"># 追番设置</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">source</span><span class="token punctuation">:</span> bili</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">path</span><span class="token punctuation">:</span> anime/index.html</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">vmid</span><span class="token punctuation">:</span> <span class="token number">397884429</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"追番列表"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">quote</span><span class="token punctuation">:</span> <span class="token string">"生命不息，追番不止！"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token key atrule">lazyload</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token key atrule">loading</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token key atrule">showMyComment</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token key atrule">pagination</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token key atrule">metaColor</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token key atrule">color</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token key atrule">webp</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token key atrule">progress</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token key atrule">extraOrder</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token key atrule">proxy</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">"代理host"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">"代理端口"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token key atrule">extra_options</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token key atrule">top_img</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token key atrule">lazyload</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></pre></td></tr></tbody></table></figure><h1 id="文章图片管理"><a class="anchor" href="#文章图片管理">#</a> 文章图片管理</h1>
<p>新建文件夹 <code>themes\shokaX\source\img\post</code>  用于存储博客文章用到的图片，注意路径必须全英文才能转化为 <code>webp</code>  格式。引用格式例如：</p>
<figure class="highlight markdown"><figcaption data-lang="markdown"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/miyano/img/post/trans/trans4/1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50%<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></pre></td></tr></tbody></table></figure><h1 id="调试技巧"><a class="anchor" href="#调试技巧">#</a> 调试技巧</h1>
<p>要想比较某个版本的仓库代码和当前最新版本的仓库代码的区别时，可以如下命令：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tbody><tr><td data-num="1"></td><td><pre><span class="token function">git</span> checkout <span class="token parameter variable">-b</span> temp-branch <span class="token operator">&lt;</span>commit_hash<span class="token operator">&gt;</span>  <span class="token comment"># 创建一个临时分支来操作旧版本</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">git</span> checkout shoka   <span class="token comment"># 切回原分支</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">git</span> branch <span class="token parameter variable">-D</span> temp-branch   <span class="token comment"># 如果临时分支不再需要，可以删除 </span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 想将 main 的最新内容合并到当前分支，不引入完整的合并历史，如下操作：</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">git</span> checkout temp-branch    <span class="token comment"># 确保在 temp-branch 分支</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">git</span> merge <span class="token parameter variable">--squash</span> shoka     <span class="token comment"># 合并 shoka 分支的最新内容</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Merged shoka's latest commit into temp-branch"</span>   <span class="token comment"># 提交更改</span></pre></td></tr></tbody></table></figure><div class="tags"><a href="/miyano/tags/Blog/" rel="tag"><i class="ic i-tag"></i>Blog</a><a href="/miyano/tags/Hexo/" rel="tag"><i class="ic i-tag"></i>Hexo</a><a href="/miyano/tags/shokaX/" rel="tag"><i class="ic i-tag"></i>shokaX</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/Playful-Exploration/shokaX主题笔记/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-01-15 20:48:40" itemprop="dateModified" datetime="2024-01-15T20:48:40+08:00">2024-01-15</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Rei<i class="ic i-at"><em>@</em></i>自分の為に楽しめ世界</li><li class="link"><strong>本文链接：</strong><a href="https://ei4869.github.io/miyano/Playful-Exploration/shokaX%E4%B8%BB%E9%A2%98%E7%AC%94%E8%AE%B0/" title="shokaX主题-笔记">https://ei4869.github.io/miyano/Playful-Exploration/shokaX主题笔记/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/miyano/Literature-Translation/2024-12-09-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E4%B8%83/" rel="prev" itemprop="url" data-background-image="https://cloudflare-imgbed-9os.pages.dev/file/eva_19.webp" title="文献翻译(七)"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>文献翻译</span><h3>文献翻译(七)</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text"> 安装过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text"> 自动部署</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">3.</span> <span class="toc-text"> 统计网站运行时间</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%9B%B8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">4.</span> <span class="toc-text"> 实现相册功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%86%8C%E4%B8%BB%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text"> 相册主页面配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%86%8C%E5%AD%90%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text"> 相册子页面配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%A0%87%E9%A2%98%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-number">5.</span> <span class="toc-text"> 页面标题自定义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AF%8F%E5%A4%A9%E9%9A%8F%E6%9C%BA%E4%B8%BB%E9%A2%98%E5%9B%BE%E7%89%87"><span class="toc-number">6.</span> <span class="toc-text"> 每天随机主题图片</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A2%9E%E6%94%B9%E4%B8%80%E4%BA%9B%E5%8F%82%E6%95%B0"><span class="toc-number">7.</span> <span class="toc-text"> 增改一些参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E5%A4%B4%E5%9B%BE%E6%A8%A1%E7%B3%8A"><span class="toc-number">8.</span> <span class="toc-text"> 移除头图模糊</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%A4%B4%E5%9B%BE%E6%A8%B1%E8%8A%B1%E7%89%B9%E6%95%88"><span class="toc-number">9.</span> <span class="toc-text"> 增加头图樱花特效</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%9F%B3%E4%B9%90%E5%88%97%E8%A1%A8"><span class="toc-number">10.</span> <span class="toc-text"> 设置音乐列表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%BF%BD%E7%95%AA%E9%A1%B5%E9%9D%A2"><span class="toc-number">11.</span> <span class="toc-text"> 设置追番页面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E5%9B%BE%E7%89%87%E7%AE%A1%E7%90%86"><span class="toc-number">12.</span> <span class="toc-text"> 文章图片管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="toc-number">13.</span> <span class="toc-text"> 调试技巧</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/miyano/Playful-Exploration/Blog%E6%90%AD%E5%BB%BA%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="bookmark" title="Blog搭建的一些知识点">Blog搭建的一些知识点</a></li><li><a href="/miyano/Playful-Exploration/2024-12-05-2dfan%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%88%B0/" rel="bookmark" title="2dfan自动签到">2dfan自动签到</a></li><li class="active"><a href="/miyano/Playful-Exploration/shokaX%E4%B8%BB%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="bookmark" title="shokaX主题-笔记">shokaX主题-笔记</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Rei" src="/miyano/assets/ai-icon.webp"><p class="name" itemprop="name">Rei</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/miyano/archives/"><span class="count">14</span><span class="name">文章</span></a></div><div class="item categories"><a href="/miyano/categories/"><span class="count">3</span><span class="name">分类</span></a></div><div class="item tags"><a href="/miyano/tags/"><span class="count">6</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/ei4869" class="item github" title="https://github.com/ei4869"><i class="ic i-github"></i></a><a href="mailto:ai4869@gmail.com" class="item email" title="mailto:ai4869@gmail.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/miyano/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/miyano/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/miyano/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/miyano/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-baibaoxiang"></i>宝箱</a><ul class="submenu"><li class="item"><a href="/miyano/gallery/" rel="section"><i class="ic i-xiangce"></i>相册</a></li><li class="item"><a href="/miyano/anime/" rel="section"><i class="ic i-pc-dongman"></i>追番</a></li></ul></li><li class="item"><a href="/miyano/about/" rel="section"><i class="ic i-user"></i>关于</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/miyano/Literature-Translation/2024-12-09-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E4%B8%83/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Literature-Translation/" title="分类于文献翻译">文献翻译</a></div><span><a href="/miyano/Literature-Translation/2024-11-25-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E4%BA%94/">文献翻译(五)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Playful-Exploration/" title="分类于整活探索">整活探索</a></div><span><a href="/miyano/Playful-Exploration/2024-12-05-2dfan%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%88%B0/">2dfan自动签到</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Literature-Translation/" title="分类于文献翻译">文献翻译</a></div><span><a href="/miyano/Literature-Translation/2024-11-24-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E4%B8%89/">文献翻译(三)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Literature-Translation/" title="分类于文献翻译">文献翻译</a></div><span><a href="/miyano/Literature-Translation/2024-11-24-%E6%96%87%E7%8C%AE%E7%BF%BB%E8%AF%91-%E5%9B%9B/">文献翻译(四)</a></span></li><li class="item"><div class="breadcrumb"><a href="/miyano/categories/Scientific-Notes/" title="分类于科研笔记">科研笔记</a></div><span><a href="/miyano/Scientific-Notes/%E6%AF%95%E8%AE%BE%E7%AC%94%E8%AE%B0%E5%9B%9B/">毕设笔记(四)</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div style="width: 100%; text-align: center;"><span id="time">此站已存活 0 天 0 小时 0 分 0 秒</span></div><script src="/miyano/js/create-time.js" defer="defer"></script><div class="status"><div class="copyright">© 2024 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Rei @ Rei の 手帳</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">201k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">3h2min</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> &amp; Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config="" type="text/javascript">var LOCAL = {
    ispost: true,
        path: `Playful-Exploration/shokaX主题笔记/`,
        favicon: {
        show: `（●´3｀●）萌え萌えキュン`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/miyano/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer=""></script></body></html>